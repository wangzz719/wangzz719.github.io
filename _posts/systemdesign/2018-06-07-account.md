---
layout: post
title: 帐户系统设计的思考
description: 帐户系统设计的思考
tags: account—system
---

# 帐户系统设计的思考

## 帐户系统的定位
帐户系统可以说是现在任何企业都会存在的基础性系统，为企业用户提供关键性服务。
帐户系统非常重要，但是也看起来没有那么重要。

**非常重要**

帐户系统关系着新用户能否注册，已注册用户能否正常登录，已登录用户能否正常使用企业为
用户提供的其他相关服务。

**没那么重要**

**设计健壮的帐户系统**对其他业务是无感知的，甚至其他业务可以不关心帐户系统的存在。
因此就显得没那么重要。

## 帐户系统做什么
帐户系统基本功能包括：
- 登录注册（授权）
- 鉴权
- 用户资料管理
- 企业帐户开放系统
- 帐户系统需要关心的其他功能

### 登录注册
注册是用户通过使用邮箱，手机号，社交帐号等方式注册成为企业用户。一般注册的时候需要用户设置
帐号基本信息，如：昵称，头像，性别等。邮箱和手机号进行注册时，一般会对邮箱和手机号的可用性
进行验证，如发送邮箱验证码和手机验证码等。

登录（授权）是指对已注册用户的认证信息进行验证，验证通过后为用户提供登录标识（token，cookie）。
常见的的验证方式包括：
- 邮箱 + 密码
- 邮箱 + 验证码
- 手机 + 密码
- 手机 + 验证码
- 社交帐号登录

**登录标识的存放**

已登录用户的登录标识需要在用户的请求中携带，这样服务端才能够识别用户身份（鉴权）。
常见的登录标识存放位置包括：
- 请求 header 中的 Authorization 字段
- 请求的 cookie 中
- 请求参数中（body，query）

登录标识的存放需要能够防止比较常见的攻击手段如 csrf，xss 等。一般通过把登录标识放置在 header
中的非 cookie 字段；放到 cookie 中时加上 httponly 标识等来达到基本的防御。

**登录标识的设计**

登录标识需要能够定位到唯一的用户，需要能够防止被非法伪造，

### 鉴权
鉴权是指通过对请求中的已登录标识进行识别，校验已登录标识：
1. 是否由企业颁发，是否合法
2. 是否已过期
3. 用户权限
4. 其他一些相关信息

通常用户的每次请求都需要进行鉴权，因此鉴权的稳定性和并发性要求较高。

### 用户资料管理
用户资料管理为用户提供基本资料的完善，修改，读取等功能。

业务上如果需要用户资料需要怎么处理？有如下方案：
1. 设计统一的用户资料管理中心，供业务获取用户资料
2. 当业务方需要具有业务自身特点的用户资料时，业务可以设计维护业务本身的用户资料管理中心

具体如何设计需要根据企业的业务特点、沟通方式来确定。

### 企业帐户开放系统
目前常用的社交帐号登录即是借用社交帐号所属企业的帐户开放系统。

企业帐户开放系统是将企业用户信息授权给其他企业使用。
通常使用 [Oauth 2.0](https://tools.ietf.org/html/rfc6749) 协议进行设计。
Oauth 2.0 协议中比较出名的是`授权码模式（Authorization Code Grant）`。

Oauth 2.0 协议具体设计规范可以参考 [RFC 6749](https://tools.ietf.org/html/rfc6749)，在此不再赘述。

### 帐户系统需要关心的其他功能
帐户系统需要关心的其他功能：
- 帐户安全风控
- 帐户反作弊

#### 帐户安全风控
- 识别撞库攻击
- 识别帐户存在风险的用户
- 其他

#### 帐户反作弊
- 识别批量注册
- 识别垃圾帐户
- 其他

帐户安全风控和帐户反作弊对企业来说是非常重要，也是企业发展前期容易被忽视的问题。

帐户安全风控和帐户反作弊需要结合数据、业务特点、企业安全以及其他的第三方数据源综合使用方能达到较好的
效果。

## 帐户系统的要求
**稳定性！！！稳定性！！！稳定性！！！**

帐户系统作为用户使用企业服务的入口，其稳定性决定了用户能否正常使用企业服务。

帐户系统其他方面的要求包括：
1. 稳定性
2. 高并发性
3. 扩展性

能够为用户提供友好的帐户相关功能，保障用户帐户的安全，并不对用户使用系统企业其他服务造成不良影响，
是帐户系统的基本要求。
